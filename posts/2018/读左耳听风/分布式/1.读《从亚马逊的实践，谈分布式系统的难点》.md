> 最近在极客时间中开始阅读左耳朵耗子的左耳听风，觉得里面都是干货，自己也在这些文章中开拓了眼界，所以想做一些笔记和心得来记录的读后感。这一年在公司工作的过程中，也接触到了很多分布式和微服务的东西，因此就想先从分布式篇章开始记录吧。

这篇博文我想说说我读了《从亚马逊的实践，谈分布式系统的难点》文章后的心得

# 亚马逊的对分布式架构的规定
文中指出，亚马逊对分布式系统的服务提出了6点要求，基本上我们在设计系统的时候也都会满足这些要求
1. 每个服务对外暴露的方式必须是服务接口，不通服务间只能通过这些接口进行互相通信
1. 每个服务必须拥有独立的数据库，不应该共享内存或者使用其他服务的动态类库，只能通过服务接口的方式来完成服务间的通信
1. 大部分情况下都会采用http的方式来定义接口，也能通过tco socket的方式来定义通信协议

文中说到，亚马逊会将服务设计成能够随时对外公开暴露的方式，这点倒是挺有远见的

# 分布式的好处
首先它使得我们的开发更加高效，同时由于服务模块化了，使得重用度提高了，当其他服务需要使用某些资源的时候，直接通过接口方式调用该模块即可，不用重新编写代码，减少了开发量，提高了效率。

在运维和部署方面，如果是单体系统，需要等到所有人都开发和测试完成后才可以发布。而分布式系统，则不会出现这种等待，可以实现快速部署

分布式能够让我们的系统服务间相互隔离，减小故障引发的问题覆盖面。以前如果是单体的系统，一个故障，可能引发整个系统的崩溃。而到了分布式系统中，如果服务对其他服务的依赖性较小，那么故障引发的问题会相对小一些。

# 分布式存在的一些问题
文中指出了分布式需要注意的一些问题

不同系统间的有时差异会很大，有可能是不同语言实现的服务，有可能是采用了不同的通信协议

不同语言会有不同的数据格式，像javascript的null和undefined，到了java时可能就是另外一种数据格式了，这时候需要约定好数据格式。

由于不同服务间只能通过接口的方式访问，而定义接口的方式有很多，有http的，有tcp的，有采用pub/sub的（如mq）

不同系统间设计不一致。举个栗子，在我们公司由于存在java团队和node团队，而java有spring cloud这样强大的分布式框架，它提供了各式各样的工具来解决不同的问题，配置化就是栗子，spring cloud提供了配置的功能，将配置从服务中独立出来，这样当需要修改配置的时候便不需要重启服务。而node大部分情况下都会把配置写在代码中，这样便导致修改配置需要重启服务的风险。就因为这一点就出现了不同的服务模式，当服务一复杂，差别程度会越来越大。

不同于单体服务，在分布式系统中服务间会有很多依赖，有可能导致一个服务出问题，会引发其他服务也出现问题，严重的话会出现“多米诺骨牌”效应，成批服务都会受到影响。例如权限服务，一旦权限系统出现问题，可想而知会出现的后果。

分布式使得所用的机器和服务数量会变得非常多，所以也相对增加了故障的概率。同时由于分布式导致了复杂度变得很高，一般人都无法全面的了解整个架构，所以运维起来也非常复杂。实际过程中遇到的问题，当一个功能出现问题，这个功能如果依赖多个服务，这时候我们需要一层一层的去判断哪个服务出现问题，这个故障会在多个团队间不断被抛出，直到找到故障的出处，同时此时所有相关团队都必须得处于待命状态，直到故障解决。这个定位故障原因的过程会很缓慢，这也是个问题。
