首先，redis提供了RDB的功能做全量的持久化，其中`bgsave`命令可以让redis新开启一个子线程来进行持久化操作，但是当数据了大时，采用bgsave会很耗时，而且如果停机了，会导致数据丢失。

此时，需要使用AOF做搭配使用，它只会记录客户端的每次写操作，相对RDB数据会少很多。

因此在进行数据恢复时，应该优先使用AOF日志来恢复数据，如果没有，则使用RDB文件进行恢复。

如果AOF的文件也很大时，这时候就应该对AOF文件进行分割，redis提供了`auto-aof-rewrite-min-size`和`auto-aof-rewrite-percentage`来配置aof文件的大小和增长率。

为了防止在aof重写期间机器突然断电，需要根据自身实际需求，配置aof重写策略，redis提供了3种方式，always、everysec、no，如果采用每秒同步一次，那么顶多也就丢失一秒的数据。如果对性能没有要求，可以使用always，每条写命令都同步一次。

## 实际操作
一般来说，redis都会做一层主从备份，主节点负责对外，从节点负责不断同步主节点的数据，达到备份的作用。

而不管是RDB还是AOF都是对redis有一定负荷作用的操作，因此我们一般不会在主节点进行持久化操作，而是会在从节点进行。

从节点不对外，没有客户端请求的压力。

但是有个影响的原因就是如果因为网络问题，导致从节点一直连不上主节点，此时就会出现数据不一致的情况。

另外如果网络出现问题的同时，主节点还宕机了，那么数据就丢失了，因此我们应该做好监控，一旦发现问题及时修复。

